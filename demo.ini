[General]
network = SmartSubstationTopology
sim-time-limit = 1s
ned-path = .;src;../inet4.5/src

# ==================== 网络基础配置 ====================
*.configurator.typename = "IPv4NetworkConfigurator"

# 确保所有设备都配置了IP协议栈
**.hasIpv4 = true
**.hasUdp = true
**.hasTcp = false

# 接口容量（10Gbps）
**.eth[*].datarate = 10Gbps
**.ppp[*].datarate = 10Gbps
*.MonitoringCenter_*.eth[*].datarate = 10Gbps  # 明确监控中心端口带宽

# Router设备IP转发配置
*.borderGateway1.hasIpv4 = true
*.borderGateway1.forwarding = true
*.borderGateway2.hasIpv4 = true
*.borderGateway2.forwarding = true
*.otnDevice.hasIpv4 = true
*.otnDevice.forwarding = true

# 网卡配置 - 确保以太网和PPP接口正常工作
**.eth[*].typename = "EthernetInterface"
**.ppp[*].typename = "PppInterface"

# ==================== OTN路由策略（基于DSCP） ====================
# I/II区（SV/GOOSE）：DSCP=56（CS7，最高优先级）->走OTN_I_II_Channel（低延迟）
# III/IV区（背景流）：DSCP=0或40（EF）->走OTN_III_IV_Channel（混跑）
# 注：OMNeT++基础模型中，路由基于目的地址而非DSCP；实际映射可通过流量工程实现

# ==================== 基础流量配置 ====================
# 1. 甲站MU -> 甲站保护装置 (SV采样值流)
# 帧率4000帧/秒(250μs/帧)，单帧大小140B，最高优先级(7)
*.MU_A.numApps = 1
*.MU_A.app[0].typename = "src.apps.SvGeneratorApp"
*.MU_A.app[0].localDestAddress = "Protection_A"
*.MU_A.app[0].localDestPort = 2000
*.MU_A.app[0].remoteDestAddress = "Protection_B"
*.MU_A.app[0].remoteDestPort = 2001
*.MU_A.app[0].messageLength = 140B
*.MU_A.app[0].sendInterval = 250us
*.MU_A.app[0].currentBase = 100A
*.MU_A.app[0].noiseStd = 1A
*.MU_A.app[0].faultEnabled = true
*.MU_A.app[0].faultStart = 2s
*.MU_A.app[0].faultDuration = 30ms
*.MU_A.app[0].faultDelta = 200A
*.MU_A.app[0].dscp = 56  # CS7最高优先级，走I/II区低延迟专用通道
*.Protection_A.numApps = 1
*.Protection_A.app[0].typename = "src.apps.DifferentialProtectionApp"
*.Protection_A.app[0].localPort = 2000
*.Protection_A.app[0].remotePort = 2001
*.Protection_A.app[0].threshold = 5A
*.Protection_A.app[0].gooseDestLocal = "IT_A"
*.Protection_A.app[0].gooseDestRemote = "IT_B"
*.Protection_A.app[0].goosePort = 3000
*.Protection_A.app[0].gooseDscp = 48  # CS6次高优先级，为GOOSE保留
*.Protection_A.app[0].recordStats = true

# 甲站智能终端接收端
*.IT_A.numApps = 1
*.IT_A.app[0].typename = "UdpSink"
*.IT_A.app[0].localPort = 3000
*.IT_A.app[0].verbose = true
*.IT_B.numApps = 1
*.IT_B.app[0].typename = "UdpSink"
*.IT_B.app[0].localPort = 3000
*.IT_B.app[0].verbose = true
*.MU_B.numApps = 1
*.MU_B.app[0].typename = "src.apps.SvGeneratorApp"
*.MU_B.app[0].localDestAddress = "Protection_B"
*.MU_B.app[0].localDestPort = 2000
*.MU_B.app[0].remoteDestAddress = "Protection_A"
*.MU_B.app[0].remoteDestPort = 2001
*.MU_B.app[0].messageLength = 140B
*.MU_B.app[0].sendInterval = 250us
*.MU_B.app[0].currentBase = 100A
*.MU_B.app[0].noiseStd = 1A
*.MU_B.app[0].faultEnabled = true
*.MU_B.app[0].faultStart = 2s
*.MU_B.app[0].faultDuration = 30ms
*.MU_B.app[0].faultDelta = 200A
*.MU_B.app[0].dscp = 56  # CS7最高优先级，走I/II区低延迟专用通道

# ==================== 母线保护配置 ====================
# 母线保护（其它背景流2）：其它相关MU向母线保护装置汇聚SV流量
# 按照SV采样值流相同参数配置：4000帧/秒，140B，最高优先级

# 甲站母线保护装置接收配置
*.BusProtection_A.numApps = 1
*.BusProtection_A.app[0].typename = "UdpSink"
*.BusProtection_A.app[0].localPort = 5000
*.BusProtection_A.app[0].verbose = true

*.Protection_B.numApps = 1
*.Protection_B.app[0].typename = "src.apps.DifferentialProtectionApp"
*.Protection_B.app[0].localPort = 2000
*.Protection_B.app[0].remotePort = 2001
*.Protection_B.app[0].threshold = 5A
*.Protection_B.app[0].gooseDestLocal = "IT_B"
*.Protection_B.app[0].gooseDestRemote = "IT_A"
*.Protection_B.app[0].goosePort = 3000
*.Protection_B.app[0].gooseDscp = 48  # CS6次高优先级，为GOOSE保留
*.Protection_B.app[0].recordStats = true
*.BusProtection_MU1_A.numApps = 1
*.BusProtection_MU1_A.app[0].typename = "UdpBasicApp"
*.BusProtection_MU1_A.app[0].localPort = 5101
*.BusProtection_MU1_A.app[0].destAddresses = "BusProtection_A"
*.BusProtection_MU1_A.app[0].destPort = 5000
*.BusProtection_MU1_A.app[0].messageLength = 140B
*.BusProtection_MU1_A.app[0].sendInterval = 250us
*.BusProtection_MU1_A.app[0].startTime = 1ms
*.BusProtection_MU1_A.app[0].packetName = "Bus_SV_1"
*.BusProtection_MU1_A.app[0].dscp = 56
*.BusProtection_MU1_A.app[0].verbose = true

# 甲站间隔2 MU -> 甲站母线保护装置
*.BusProtection_MU2_A.numApps = 1
*.BusProtection_MU2_A.app[0].typename = "UdpBasicApp"
*.BusProtection_MU2_A.app[0].localPort = 5102
*.BusProtection_MU2_A.app[0].destAddresses = "BusProtection_A"
*.BusProtection_MU2_A.app[0].destPort = 5000
*.BusProtection_MU2_A.app[0].messageLength = 140B
*.BusProtection_MU2_A.app[0].sendInterval = 250us
*.BusProtection_MU2_A.app[0].startTime = 2ms
*.BusProtection_MU2_A.app[0].packetName = "Bus_SV_2"
*.BusProtection_MU2_A.app[0].dscp = 56
*.BusProtection_MU2_A.app[0].verbose = true

# 甲站间隔3 MU -> 甲站母线保护装置
*.BusProtection_MU3_A.numApps = 1
*.BusProtection_MU3_A.app[0].typename = "UdpBasicApp"
*.BusProtection_MU3_A.app[0].localPort = 5103
*.BusProtection_MU3_A.app[0].destAddresses = "BusProtection_A"
*.BusProtection_MU3_A.app[0].destPort = 5000
*.BusProtection_MU3_A.app[0].messageLength = 140B
*.BusProtection_MU3_A.app[0].sendInterval = 250us
*.BusProtection_MU3_A.app[0].startTime = 3ms
*.BusProtection_MU3_A.app[0].packetName = "Bus_SV_3"
*.BusProtection_MU3_A.app[0].dscp = 56
*.BusProtection_MU3_A.app[0].verbose = true

# 乙站母线保护装置接收配置
*.BusProtection_B.numApps = 1
*.BusProtection_B.app[0].typename = "UdpSink"
*.BusProtection_B.app[0].localPort = 5000
*.BusProtection_B.app[0].verbose = true

# 乙站间隔1 MU -> 乙站母线保护装置
*.BusProtection_MU1_B.numApps = 1
*.BusProtection_MU1_B.app[0].typename = "UdpBasicApp"
*.BusProtection_MU1_B.app[0].localPort = 5101
*.BusProtection_MU1_B.app[0].destAddresses = "BusProtection_B"
*.BusProtection_MU1_B.app[0].destPort = 5000
*.BusProtection_MU1_B.app[0].messageLength = 140B
*.BusProtection_MU1_B.app[0].sendInterval = 250us
*.BusProtection_MU1_B.app[0].startTime = 4ms
*.BusProtection_MU1_B.app[0].packetName = "Bus_SV_1"
*.BusProtection_MU1_B.app[0].dscp = 56
*.BusProtection_MU1_B.app[0].verbose = true

# 乙站间隔2 MU -> 乙站母线保护装置
*.BusProtection_MU2_B.numApps = 1
*.BusProtection_MU2_B.app[0].typename = "UdpBasicApp"
*.BusProtection_MU2_B.app[0].localPort = 5102
*.BusProtection_MU2_B.app[0].destAddresses = "BusProtection_B"
*.BusProtection_MU2_B.app[0].destPort = 5000
*.BusProtection_MU2_B.app[0].messageLength = 140B
*.BusProtection_MU2_B.app[0].sendInterval = 250us
*.BusProtection_MU2_B.app[0].startTime = 5ms
*.BusProtection_MU2_B.app[0].packetName = "Bus_SV_2"
*.BusProtection_MU2_B.app[0].dscp = 56
*.BusProtection_MU2_B.app[0].verbose = true

# 乙站间隔3 MU -> 乙站母线保护装置
*.BusProtection_MU3_B.numApps = 1
*.BusProtection_MU3_B.app[0].typename = "UdpBasicApp"
*.BusProtection_MU3_B.app[0].localPort = 5103
*.BusProtection_MU3_B.app[0].destAddresses = "BusProtection_B"
*.BusProtection_MU3_B.app[0].destPort = 5000
*.BusProtection_MU3_B.app[0].messageLength = 140B
*.BusProtection_MU3_B.app[0].sendInterval = 250us
*.BusProtection_MU3_B.app[0].startTime = 6ms
*.BusProtection_MU3_B.app[0].packetName = "Bus_SV_3"
*.BusProtection_MU3_B.app[0].dscp = 56
*.BusProtection_MU3_B.app[0].verbose = true

# ==================== 视频巡检流配置 ====================
# 10个摄像头，帧率30fps，帧长1500B（修改为合理大小，帧长10MB）
# 发送到运维数据服务器

# 甲站摄像头1-10
*.Camera*_A.numApps = 2
*.Camera*_A.app[0].typename = "UdpBasicApp"
*.Camera*_A.app[0].destAddresses = "MonitoringCenter_A"
*.Camera*_A.app[0].destPort = 6000
*.Camera*_A.app[0].messageLength = 1500B
*.Camera*_A.app[0].sendInterval = 33.33ms
*.Camera*_A.app[0].startTime = uniform(0s, 1s)
*.Camera*_A.app[0].packetName = "Video_Stream"
*.Camera*_A.app[0].dscp = 0
*.Camera*_A.app[0].verbose = true
*.Camera*_A.app[1].typename = "UdpBasicApp"
*.Camera*_A.app[1].localPort = 6100
*.Camera*_A.app[1].destAddresses = "MonitoringCenter_Main"
*.Camera*_A.app[1].destPort = 6000
*.Camera*_A.app[1].messageLength = 1500B
*.Camera*_A.app[1].sendInterval = 33.33ms
*.Camera*_A.app[1].startTime = uniform(0s, 1s)
*.Camera*_A.app[1].packetName = "Video_Stream_Main"
*.Camera*_A.app[1].dscp = 0
*.Camera*_A.app[1].verbose = true

# 乙站摄像头1-10
*.Camera*_B.numApps = 2
*.Camera*_B.app[0].typename = "UdpBasicApp"
*.Camera*_B.app[0].destAddresses = "MonitoringCenter_B"
*.Camera*_B.app[0].destPort = 6000
*.Camera*_B.app[0].messageLength = 1500B
*.Camera*_B.app[0].sendInterval = 33.33ms
*.Camera*_B.app[0].startTime = uniform(0s, 1s)
*.Camera*_B.app[0].packetName = "Video_Stream"
*.Camera*_B.app[0].dscp = 0
*.Camera*_B.app[0].verbose = true
*.Camera*_B.app[1].typename = "UdpBasicApp"
*.Camera*_B.app[1].localPort = 6100
*.Camera*_B.app[1].destAddresses = "MonitoringCenter_Main"
*.Camera*_B.app[1].destPort = 6000
*.Camera*_B.app[1].messageLength = 1500B
*.Camera*_B.app[1].sendInterval = 33.33ms
*.Camera*_B.app[1].startTime = uniform(0s, 1s)
*.Camera*_B.app[1].packetName = "Video_Stream_Main"
*.Camera*_B.app[1].dscp = 0
*.Camera*_B.app[1].verbose = true

# 运维数据服务器接收端
*.MonitoringCenter_Main.numApps = 2
*.MonitoringCenter_Main.app[0].typename = "UdpSink"
*.MonitoringCenter_Main.app[0].localPort = 6000
*.MonitoringCenter_Main.app[0].verbose = true
*.MonitoringCenter_Main.app[1].typename = "UdpSink"
*.MonitoringCenter_Main.app[1].localPort = 9002
*.MonitoringCenter_Main.app[1].verbose = true

# ==================== VoIP语音流配置 ====================
# 帧率20ms，单帧200B，延迟<150ms，抖动<30ms
# 站内/站间调度电话

# 甲站VoIP1/2 -> 甲站监控中心
*.VoIP*_A.numApps = 1
*.VoIP*_A.app[0].typename = "UdpBasicApp"
*.VoIP*_A.app[0].localPort = 7001
*.VoIP*_A.app[0].destAddresses = "MonitoringCenter_A"
*.VoIP*_A.app[0].destPort = 7100
*.VoIP*_A.app[0].messageLength = 200B
*.VoIP*_A.app[0].sendInterval = 20ms
*.VoIP*_A.app[0].startTime = uniform(0s, 200ms)
*.VoIP*_A.app[0].packetName = "VoIP_Stream"
*.VoIP*_A.app[0].dscp = 0  
*.VoIP*_A.app[0].verbose = true

# 乙站VoIP1/2 -> 乙站监控中心
*.VoIP*_B.numApps = 1
*.VoIP*_B.app[0].typename = "UdpBasicApp"
*.VoIP*_B.app[0].localPort = 8001
*.VoIP*_B.app[0].destAddresses = "MonitoringCenter_B"
*.VoIP*_B.app[0].destPort = 7100
*.VoIP*_B.app[0].messageLength = 200B
*.VoIP*_B.app[0].sendInterval = 20ms
*.VoIP*_B.app[0].startTime = uniform(0s, 200ms)
*.VoIP*_B.app[0].packetName = "VoIP_Stream"
*.VoIP*_B.app[0].dscp = 0
*.VoIP*_B.app[0].verbose = true
*.VoIP2_B.app[0].destPort = 7100
*.VoIP2_B.app[0].messageLength = 200B
*.VoIP2_B.app[0].sendInterval = 20ms
*.VoIP2_B.app[0].startTime = uniform(0s, 200ms)
*.VoIP2_B.app[0].packetName = "VoIP_Stream"
*.VoIP2_B.app[0].dscp = 0
*.VoIP2_B.app[0].verbose = true

# ==================== 运维数据流配置 ====================
# 传输文件、同步数据库等，突发性高
# 用随机数模拟突发流量

# 统一监控中心应用定义（相同条目集中在此，避免覆盖）
# app[0]: 接收视频流 app[1]: 发送运维数据突发流量 app[2]: 接收运维数据突发流量 app[3]: 接收VoIP流
*.MonitoringCenter_A.app[0].typename = "UdpSink"
*.MonitoringCenter_A.app[0].localPort = 6000
*.MonitoringCenter_A.app[0].verbose = true

*.MonitoringCenter_A.app[1].typename = "UdpBasicApp"
*.MonitoringCenter_A.app[1].localPort = 9001
*.MonitoringCenter_A.app[1].destAddresses = "MonitoringCenter_Main"
*.MonitoringCenter_A.app[1].destPort = 9002
*.MonitoringCenter_A.app[1].messageLength = int(normal(1500B, 500B))
*.MonitoringCenter_A.app[1].sendInterval = exponential(0.1s)
*.MonitoringCenter_A.app[1].startTime = 500ms      
*.MonitoringCenter_A.app[1].packetName = "OM_Data_Burst_A"
*.MonitoringCenter_A.app[1].dscp = 0
*.MonitoringCenter_A.app[1].verbose = true

*.MonitoringCenter_A.app[2].typename = "UdpSink"
*.MonitoringCenter_A.app[2].localPort = 9004
*.MonitoringCenter_A.app[2].verbose = true

*.MonitoringCenter_A.app[3].typename = "UdpSink"
*.MonitoringCenter_A.app[3].localPort = 7100
*.MonitoringCenter_A.app[3].verbose = true

*.MonitoringCenter_B.numApps = 4
*.MonitoringCenter_B.app[0].typename = "UdpSink"
*.MonitoringCenter_B.app[0].localPort = 6000
*.MonitoringCenter_B.app[0].verbose = true

*.MonitoringCenter_B.app[1].typename = "UdpSink"
*.MonitoringCenter_B.app[1].localPort = 9002
*.MonitoringCenter_B.app[1].verbose = true

*.MonitoringCenter_B.app[2].typename = "UdpBasicApp"
*.MonitoringCenter_B.app[2].localPort = 9003
*.MonitoringCenter_B.app[2].destAddresses = "MonitoringCenter_Main"
*.MonitoringCenter_B.app[2].destPort = 9004
*.MonitoringCenter_B.app[2].messageLength = int(normal(1500B, 500B))
*.MonitoringCenter_B.app[2].sendInterval = exponential(0.1s)
*.MonitoringCenter_B.app[2].startTime = 600ms
*.MonitoringCenter_B.app[2].packetName = "OM_Data_Burst_B"
*.MonitoringCenter_B.app[2].dscp = 0
*.MonitoringCenter_B.app[2].verbose = true

*.MonitoringCenter_B.app[3].typename = "UdpSink"
*.MonitoringCenter_B.app[3].localPort = 7100
*.MonitoringCenter_B.app[3].verbose = true

# ==================== 统计配置 ====================
# 启用端到端时延统计
**.app[*].source.packetSentSignal = true
**.app[*].sink.packetReceivedSignal = true
**.app[*].sink.endToEndDelayStatistic.record = true
**.app[*].sink.delayHistogram.record = true
**.app[*].sink.numReceivedStatistic.record = true
**.app[*].sink.throughputStatistic.record = true

# 抖动统计
**.app[*].sink.jitterStatistic.record = true
**.app[*].sink.jitterHistogram.record = true

# VoIP流特殊统计
*.VoIP*_A.app[*].sink.delayThreshold = 150ms
*.VoIP*_A.app[*].sink.jitterThreshold = 30ms
*.VoIP*_B.app[*].sink.delayThreshold = 150ms
*.VoIP*_B.app[*].sink.jitterThreshold = 30ms

# SV流特殊统计
*.MU_A.app[0].sink.delayThreshold = 30ms
*.MU_A.app[0].sink.jitterThreshold = 250us
*.BusProtection_MU*_A.app[*].sink.delayThreshold = 30ms
*.BusProtection_MU*_A.app[*].sink.jitterThreshold = 250us

# ==================== 可视化配置 ====================
# 简化显示，突出关键信息
*.*_A.displayString = "i=abstract/pc"
*.*_B.displayString = "i=abstract/pc" 
*.borderGateway*.displayString = "i=misc/router"
*.otnDevice.displayString = "i=misc/router_vs"

# 关键设备特殊标记
*.MU_A.displayString = "i=block/switch,green"
*.Protection_A.displayString = "i=block/computer,red"
*.IT_A.displayString = "i=block/plug,blue"
*.Protection_B.displayString = "i=block/computer,red"
*.MonitoringCenter_A.displayString = "i=block/server,blue"
*.MonitoringCenter_B.displayString = "i=block/server,blue"
*.MonitoringCenter_Main.displayString = "i=block/server,cyan"

# 母线保护设备特殊标记
*.BusProtection_A.displayString = "i=block/computer,orange"
*.BusProtection_B.displayString = "i=block/computer,orange"
*.BusProtection_MU*_A.displayString = "i=block/switch,yellow"
*.BusProtection_MU*_B.displayString = "i=block/switch,yellow"

# 背景流量设备标记
*.Camera*_A.displayString = "i=device/camera,gray"
*.Camera*_B.displayString = "i=device/camera,gray"
*.VoIP1_A.displayString = "i=device/phone,gray"
*.VoIP2_A.displayString = "i=device/phone,gray"
*.VoIP1_B.displayString = "i=device/phone,gray"
*.VoIP2_B.displayString = "i=device/phone,gray"

# 信道显示设置
**.channel.displayString = "ls=black,1"

